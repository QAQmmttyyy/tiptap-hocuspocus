# å®æ—¶åä½œæ–‡æ¡£ç®¡ç†ç³»ç»Ÿ - å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ

## é¡¹ç›®æ¦‚è¿°

åŸºäºç°æœ‰çš„å®æ—¶åä½œç¼–è¾‘å™¨ï¼Œå¢å¼ºæ–‡æ¡£ç®¡ç†åŠŸèƒ½ï¼Œå®ç°å®Œæ•´çš„æ–‡æ¡£ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼ˆCRUDï¼‰æ“ä½œï¼ŒåŒæ—¶ä¼˜åŒ–ç³»ç»Ÿå¯åŠ¨æµç¨‹ã€‚

## æŠ€æœ¯ç›®æ ‡

### ä¸»è¦åŠŸèƒ½
1. **è‡ªåŠ¨å¯åŠ¨åä½œæœåŠ¡å™¨** - é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ Hocuspocus æœåŠ¡å™¨
2. **æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ** - å®Œæ•´çš„æ–‡æ¡£ CRUD æ“ä½œ
3. **ç”¨æˆ·ç®¡ç†** - åŸºç¡€çš„ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
4. **æ•°æ®æŒä¹…åŒ–** - æ–‡æ¡£å†…å®¹å’Œå…ƒæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨
5. **å®æ—¶åä½œ** - æ— æ„ŸçŸ¥çš„è‡ªåŠ¨ä¿å­˜å’Œå®æ—¶åŒæ­¥

### éåŠŸèƒ½æ€§è¦æ±‚
- æ€§èƒ½ï¼šæ”¯æŒ 100+ å¹¶å‘ç”¨æˆ·
- å¯æ‰©å±•æ€§ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
- å¯é æ€§ï¼šæ•°æ®ä¸€è‡´æ€§å’Œå®¹é”™æœºåˆ¶
- å®‰å…¨æ€§ï¼šåŸºç¡€çš„æƒé™æ§åˆ¶

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### ä¼˜åŒ–åçš„æ¶æ„

```mermaid
graph TB
    A[æµè§ˆå™¨å®¢æˆ·ç«¯] --> B[Next.js App Router]
    A --> G[Hocuspocus Server]
    
    B --> C[API Routes]
    B --> D[React ç»„ä»¶]
    
    C --> E[Prisma ORM]
    G --> E[Prisma ORM]
    
    E --> H[(SQLite/PostgreSQL)]
    
    subgraph "æ–‡æ¡£å†…å®¹æµ"
        G -.-> H
        H -.-> G
    end
    
    subgraph "å…ƒæ•°æ®æµ"
        C -.-> H
        H -.-> C
    end
    
    subgraph "å®æ—¶åä½œå±‚"
        G
        I[Y.js æ–‡æ¡£çŠ¶æ€]
    end
    
    subgraph "ç”¨æˆ·ç•Œé¢å±‚"
        D
        J[Tiptap ç¼–è¾‘å™¨]
        K[shadcn/ui ç»„ä»¶]
    end
```

### æ¶æ„ä¼˜åŠ¿

1. **èŒè´£æ¸…æ™°åˆ†ç¦»**ï¼š
   - Hocuspocus â† æ–‡æ¡£å†…å®¹å’Œå®æ—¶åä½œ
   - REST API â† æ–‡æ¡£å…ƒæ•°æ®ç®¡ç†
   - å‰ç«¯ç»„ä»¶ â† ç”¨æˆ·äº¤äº’ç•Œé¢

2. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - Hocuspocus ç›´è¿æ•°æ®åº“ï¼Œå‡å°‘ HTTP è°ƒç”¨å¼€é”€
   - å®æ—¶ä¿å­˜æœºåˆ¶ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ

3. **æ‰©å±•æ€§å¼º**ï¼š
   - æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
   - æ”¯æŒå¤šç§è®¤è¯æ–¹å¼

## æŠ€æœ¯é€‰å‹

### 1. æ•°æ®åº“å±‚
**é€‰æ‹©ï¼šPrisma + SQLite/PostgreSQL**

```typescript
// æŠ€æœ¯æ ˆ
- Prisma 5.x - ç°ä»£åŒ– ORMï¼Œå®Œç¾é›†æˆ TypeScript
- SQLite - å¼€å‘ç¯å¢ƒï¼Œé›¶é…ç½®
- PostgreSQL - ç”Ÿäº§ç¯å¢ƒï¼Œé«˜æ€§èƒ½
```

**ä¼˜åŠ¿ï¼š**
- Prisma æä¾›ç±»å‹å®‰å…¨çš„æ•°æ®åº“è®¿é—®
- æ”¯æŒæ•°æ®åº“è¿ç§»å’Œç§å­æ•°æ®
- ä¸ Next.js å®Œç¾é›†æˆ
- æ”¯æŒå¤šæ•°æ®åº“åˆ‡æ¢

### 2. å®Œæ•´æ•°æ®æ¨¡å‹è®¾è®¡

```prisma
// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite" // å¼€å‘ç¯å¢ƒ
  // provider = "postgresql" // ç”Ÿäº§ç¯å¢ƒ
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // å…³è”å…³ç³»
  documents      Document[]
  collaborations DocumentCollaborator[]
  activities     DocumentActivity[]
  
  @@map("users")
}

model Document {
  id          String   @id @default(cuid())
  title       String
  description String?
  content     Bytes?   // Yjs æ–‡æ¡£çŠ¶æ€
  isPublic    Boolean  @default(false)
  version     Int      @default(0)  // ç‰ˆæœ¬æ§åˆ¶
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // å…³è”å…³ç³»
  authorId      String
  author        User     @relation(fields: [authorId], references: [id])
  collaborators DocumentCollaborator[]
  activities    DocumentActivity[]
  snapshots     DocumentSnapshot[]
  
  @@map("documents")
}

model DocumentCollaborator {
  id         String           @id @default(cuid())
  userId     String
  documentId String
  role       CollaboratorRole @default(EDITOR)
  createdAt  DateTime         @default(now())
  
  // å…³è”å…³ç³»
  user       User     @relation(fields: [userId], references: [id])
  document   Document @relation(fields: [documentId], references: [id])
  
  @@unique([userId, documentId])
  @@map("document_collaborators")
}

model DocumentActivity {
  id         String         @id @default(cuid())
  documentId String
  userId     String
  action     DocumentAction
  metadata   Json?
  createdAt  DateTime       @default(now())
  
  // å…³è”å…³ç³»
  document   Document @relation(fields: [documentId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
  
  @@index([documentId, createdAt])
  @@map("document_activities")
}

model DocumentSnapshot {
  id         String   @id @default(cuid())
  documentId String
  content    Bytes
  version    Int
  note       String?
  createdAt  DateTime @default(now())
  
  // å…³è”å…³ç³»
  document   Document @relation(fields: [documentId], references: [id])
  
  @@map("document_snapshots")
}

enum CollaboratorRole {
  OWNER
  EDITOR
  VIEWER
}

enum DocumentAction {
  CONNECT
  DISCONNECT
  EDIT
  CREATE
  DELETE
  SHARE
}
```

### 3. API æ¶æ„è®¾è®¡

**RESTful API + App Router**

```typescript
// API è·¯ç”±ç»“æ„
/api/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ login/route.ts
â”‚   â”œâ”€â”€ logout/route.ts
â”‚   â””â”€â”€ profile/route.ts
â”œâ”€â”€ documents/
â”‚   â”œâ”€â”€ route.ts                    # GET: åˆ—è¡¨, POST: åˆ›å»º
â”‚   â”œâ”€â”€ [id]/route.ts              # GET: è¯¦æƒ…, PUT: æ›´æ–°, DELETE: åˆ é™¤
â”‚   â””â”€â”€ [id]/collaborators/route.ts # åä½œè€…ç®¡ç†
â””â”€â”€ collaboration/
    â””â”€â”€ route.ts                   # Hocuspocus æœåŠ¡å™¨ç®¡ç†
```

### 4. çŠ¶æ€ç®¡ç†

**é€‰æ‹©ï¼šZustand + TanStack Query**

```typescript
// è½»é‡çº§çŠ¶æ€ç®¡ç†
- Zustand - å…¨å±€çŠ¶æ€ç®¡ç†
- TanStack Query - æœåŠ¡å™¨çŠ¶æ€ç®¡ç†å’Œç¼“å­˜
- åŸç”Ÿ React state - ç»„ä»¶çŠ¶æ€
```

### 5. è®¤è¯ç³»ç»Ÿ

**é€‰æ‹©ï¼šNextAuth.js v5**

```typescript
// è®¤è¯æä¾›è€…
- GitHub OAuth
- Google OAuth  
- Email/Password (å¯é€‰)
```

## ğŸ”§ æ ¸å¿ƒå®ç°

### 1. å¢å¼ºçš„ Hocuspocus æœåŠ¡å™¨ï¼ˆç›´è¿æ•°æ®åº“ï¼‰

```typescript
// lib/enhanced-hocuspocus-server.ts
import { Server } from '@hocuspocus/server'
import { db } from './db'
import { verifyAuthToken } from './auth-utils'
import * as Y from 'yjs'

export function createEnhancedHocuspocusServer() {
  return new Server({
    port: 1234,
    name: 'enhanced-hocuspocus-server',

    // ğŸ”§ ç›´æ¥ä»æ•°æ®åº“åŠ è½½æ–‡æ¡£
    async onLoadDocument(data) {
      try {
        console.log(`ğŸ“– åŠ è½½æ–‡æ¡£: ${data.documentName}`)
        
        const document = await db.document.findUnique({
          where: { id: data.documentName },
          select: { content: true, title: true, version: true }
        })

        if (document?.content) {
          console.log(`âœ… æ–‡æ¡£åŠ è½½æˆåŠŸ: ${document.title} (v${document.version})`)
          return document.content
        }

        console.log(`ğŸ“ åˆ›å»ºæ–°æ–‡æ¡£: ${data.documentName}`)
        return null // è¿”å› null åˆ›å»ºç©ºç™½æ–‡æ¡£
        
      } catch (error) {
        console.error('âŒ æ–‡æ¡£åŠ è½½å¤±è´¥:', error)
        return null
      }
    },

    // ğŸ”§ å®æ—¶æŒä¹…åŒ– - ç›´æ¥ä¿å­˜åˆ°æ•°æ®åº“
    async onStoreDocument(data) {
      try {
        const update = Y.encodeStateAsUpdate(data.document)
        const now = new Date()
        
        // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
        const userId = data.context?.user?.id || 'system'
        
        await db.document.upsert({
          where: { id: data.documentName },
          update: { 
            content: Buffer.from(update),
            updatedAt: now,
            version: { increment: 1 }
          },
          create: {
            id: data.documentName,
            title: 'æœªå‘½åæ–‡æ¡£',
            description: '',
            content: Buffer.from(update),
            isPublic: false,
            authorId: userId,
            version: 1,
            createdAt: now,
            updatedAt: now
          }
        })

        // è®°å½•ç¼–è¾‘æ´»åŠ¨
        await db.documentActivity.create({
          data: {
            documentId: data.documentName,
            userId,
            action: 'EDIT',
            metadata: { contentLength: update.length },
            createdAt: now
          }
        }).catch(console.error)

        console.log(`ğŸ’¾ æ–‡æ¡£ä¿å­˜æˆåŠŸ: ${data.documentName} ${now.toLocaleTimeString()}`)
        
      } catch (error) {
        console.error('âŒ æ–‡æ¡£ä¿å­˜å¤±è´¥:', error)
        throw error // è®© Hocuspocus çŸ¥é“ä¿å­˜å¤±è´¥
      }
    },

    // ğŸ”§ ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶
    async onAuthenticate(data) {
      try {
        const token = data.token
        if (!token) {
          return { user: generateGuestUser() }
        }

        // éªŒè¯ JWT token
        const user = await verifyAuthToken(token)
        if (!user) {
          return { user: generateGuestUser() }
        }

        // æ£€æŸ¥æ–‡æ¡£æƒé™
        const hasPermission = await checkDocumentPermission(user.id, data.documentName)
        if (!hasPermission) {
          throw new Error('æ— æƒé™è®¿é—®æ­¤æ–‡æ¡£')
        }

        return {
          user: {
            id: user.id,
            name: user.name,
            avatar: user.avatar,
            color: generateUserColor(user.id)
          }
        }
        
      } catch (error) {
        console.error('âŒ è®¤è¯å¤±è´¥:', error)
        throw error
      }
    },

    // ğŸ”§ è¿æ¥ç®¡ç†å’Œæ´»åŠ¨è®°å½•
    async onConnect(data) {
      console.log(`ğŸ‘¤ ç”¨æˆ·è¿æ¥: ${data.socketId} -> æ–‡æ¡£: ${data.documentName}`)
      
      const userId = data.context?.user?.id || 'anonymous'
      
      // è®°å½•è¿æ¥æ´»åŠ¨
      await db.documentActivity.create({
        data: {
          documentId: data.documentName,
          userId,
          action: 'CONNECT',
          metadata: { socketId: data.socketId },
          createdAt: new Date()
        }
      }).catch(console.error)
    },

    async onDisconnect(data) {
      console.log(`ğŸ‘‹ ç”¨æˆ·æ–­å¼€: ${data.socketId}`)
      
      const userId = data.context?.user?.id || 'anonymous'
      
      // è®°å½•æ–­å¼€æ´»åŠ¨
      await db.documentActivity.create({
        data: {
          documentId: data.documentName,
          userId,
          action: 'DISCONNECT',
          metadata: { socketId: data.socketId },
          createdAt: new Date()
        }
      }).catch(console.error)
    },

    // ğŸ”§ è‡ªåŠ¨ä¿å­˜ç­–ç•¥
    debounce: 2000,       // 2ç§’é˜²æŠ–
    maxDebounce: 30000,   // 30ç§’å¼ºåˆ¶ä¿å­˜
  })
}

// è¾…åŠ©å‡½æ•°
function generateGuestUser() {
  return {
    id: 'guest_' + Math.random().toString(36).substr(2, 9),
    name: `è®¿å®¢${Math.floor(Math.random() * 1000)}`,
    color: generateRandomColor()
  }
}

function generateUserColor(userId: string): string {
  const colors = [
    '#ef4444', '#f97316', '#eab308', '#22c55e', 
    '#06b6d4', '#3b82f6', '#8b5cf6', '#ec4899'
  ]
  const hash = userId.split('').reduce((a, b) => {
    a = ((a << 5) - a) + b.charCodeAt(0)
    return a & a
  }, 0)
  return colors[Math.abs(hash) % colors.length]
}

function generateRandomColor(): string {
  return '#' + Math.floor(Math.random()*16777215).toString(16)
}

async function checkDocumentPermission(userId: string, documentId: string): Promise<boolean> {
  const document = await db.document.findFirst({
    where: {
      id: documentId,
      OR: [
        { authorId: userId },
        { collaborators: { some: { userId } } },
        { isPublic: true }
      ]
    }
  })
  
  return !!document
}
```

### 2. è‡ªåŠ¨å¯åŠ¨é…ç½®

```typescript
// lib/auto-start-server.ts
import { createEnhancedHocuspocusServer } from './enhanced-hocuspocus-server'

let hocuspocusServer: any = null
let serverStarted = false

export async function ensureServerRunning() {
  if (!serverStarted) {
    try {
      console.log('ğŸš€ è‡ªåŠ¨å¯åŠ¨ Hocuspocus æœåŠ¡å™¨...')
      
      hocuspocusServer = createEnhancedHocuspocusServer()
      await hocuspocusServer.listen()
      
      serverStarted = true
      console.log('âœ… Hocuspocus æœåŠ¡å™¨å·²è‡ªåŠ¨å¯åŠ¨åœ¨ç«¯å£ 1234')
    } catch (error) {
      console.error('âŒ Hocuspocus æœåŠ¡å™¨å¯åŠ¨å¤±è´¥:', error)
    }
  }
}

export function getServerStatus() {
  return {
    running: serverStarted,
    port: 1234,
    connections: hocuspocusServer?.getConnectionsCount() || 0
  }
}

export function stopServer() {
  if (hocuspocusServer) {
    hocuspocusServer.destroy()
    hocuspocusServer = null
    serverStarted = false
    console.log('ğŸ›‘ Hocuspocus æœåŠ¡å™¨å·²åœæ­¢')
  }
}
```

```typescript
// app/layout.tsx
import { ensureServerRunning } from '@/lib/auto-start-server'

export default async function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  // åœ¨æœåŠ¡å™¨ç«¯è‡ªåŠ¨å¯åŠ¨
  if (typeof window === 'undefined') {
    await ensureServerRunning()
  }

  return (
    <html lang="zh-CN">
      <body>{children}</body>
    </html>
  )
}
```

### 3. è®¤è¯ç³»ç»Ÿé›†æˆ

```typescript
// lib/auth.ts
import NextAuth from 'next-auth'
import GitHub from 'next-auth/providers/github'
import Google from 'next-auth/providers/google'
import { PrismaAdapter } from '@auth/prisma-adapter'
import { db } from './db'

export const { handlers, auth, signIn, signOut } = NextAuth({
  adapter: PrismaAdapter(db),
  providers: [
    GitHub({
      clientId: process.env.GITHUB_CLIENT_ID!,
      clientSecret: process.env.GITHUB_CLIENT_SECRET!,
    }),
    Google({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    }),
  ],
  callbacks: {
    session: ({ session, user }) => ({
      ...session,
      user: {
        ...session.user,
        id: user.id,
      },
    }),
    jwt: ({ token, user }) => {
      if (user) {
        token.userId = user.id
      }
      return token
    },
  },
  pages: {
    signIn: '/auth/signin',
    error: '/auth/error',
  },
})

// éªŒè¯è®¤è¯ token çš„å·¥å…·å‡½æ•°
export async function verifyAuthToken(token: string) {
  try {
    const jwt = await import('jsonwebtoken')
    const payload = jwt.verify(token, process.env.NEXTAUTH_SECRET!) as any
    return payload.user
  } catch {
    return null
  }
}
```

### 4. æ–‡æ¡£ç®¡ç† API

```typescript
// app/api/documents/route.ts
import { auth } from '@/lib/auth'
import { db } from '@/lib/db'
import { NextRequest } from 'next/server'

// è·å–æ–‡æ¡£åˆ—è¡¨
export async function GET(request: NextRequest) {
  const session = await auth()
  if (!session?.user) {
    return Response.json({ error: 'æœªæˆæƒ' }, { status: 401 })
  }

  const { searchParams } = new URL(request.url)
  const page = parseInt(searchParams.get('page') || '1')
  const limit = parseInt(searchParams.get('limit') || '10')
  const search = searchParams.get('search') || ''

  const where = {
    AND: [
      {
        OR: [
          { authorId: session.user.id },
          { collaborators: { some: { userId: session.user.id } } },
          { isPublic: true }
        ]
      },
      search ? {
        OR: [
          { title: { contains: search } },
          { description: { contains: search } }
        ]
      } : {}
    ]
  }

  const [documents, total] = await Promise.all([
    db.document.findMany({
      where,
      select: {
        id: true,
        title: true,
        description: true,
        isPublic: true,
        version: true,
        createdAt: true,
        updatedAt: true,
        author: { select: { id: true, name: true, avatar: true } },
        collaborators: {
          include: {
            user: { select: { id: true, name: true, avatar: true } }
          }
        },
        _count: { select: { collaborators: true, activities: true } }
      },
      orderBy: { updatedAt: 'desc' },
      skip: (page - 1) * limit,
      take: limit,
    }),
    db.document.count({ where })
  ])

  return Response.json({ 
    documents, 
    pagination: {
      page,
      limit,
      total,
      pages: Math.ceil(total / limit)
    }
  })
}

// åˆ›å»ºæ–‡æ¡£
export async function POST(request: NextRequest) {
  const session = await auth()
  if (!session?.user) {
    return Response.json({ error: 'æœªæˆæƒ' }, { status: 401 })
  }

  const { title, description, isPublic } = await request.json()

  const document = await db.document.create({
    data: {
      title,
      description,
      isPublic: isPublic || false,
      authorId: session.user.id,
    },
    include: {
      author: { select: { id: true, name: true, avatar: true } },
    },
  })

  // è®°å½•åˆ›å»ºæ´»åŠ¨
  await db.documentActivity.create({
    data: {
      documentId: document.id,
      userId: session.user.id,
      action: 'CREATE',
      metadata: { title, description },
    }
  })

  return Response.json({ document }, { status: 201 })
}
```

```typescript
// app/api/documents/[id]/route.ts
import { auth } from '@/lib/auth'
import { db } from '@/lib/db'
import { NextRequest } from 'next/server'

// è·å–æ–‡æ¡£è¯¦æƒ…
export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const session = await auth()
  if (!session?.user) {
    return Response.json({ error: 'æœªæˆæƒ' }, { status: 401 })
  }

  const document = await db.document.findFirst({
    where: {
      id: params.id,
      OR: [
        { authorId: session.user.id },
        { collaborators: { some: { userId: session.user.id } } },
        { isPublic: true }
      ]
    },
    include: {
      author: { select: { id: true, name: true, avatar: true } },
      collaborators: {
        include: {
          user: { select: { id: true, name: true, avatar: true } },
        }
      },
      activities: {
        take: 10,
        orderBy: { createdAt: 'desc' },
        include: {
          user: { select: { id: true, name: true, avatar: true } }
        }
      }
    }
  })

  if (!document) {
    return Response.json({ error: 'æ–‡æ¡£ä¸å­˜åœ¨' }, { status: 404 })
  }

  return Response.json({ document })
}

// æ›´æ–°æ–‡æ¡£å…ƒæ•°æ®
export async function PUT(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const session = await auth()
  if (!session?.user) {
    return Response.json({ error: 'æœªæˆæƒ' }, { status: 401 })
  }

  const { title, description, isPublic } = await request.json()

  const document = await db.document.findFirst({
    where: {
      id: params.id,
      OR: [
        { authorId: session.user.id },
        { collaborators: { some: { userId: session.user.id, role: { in: ['OWNER', 'EDITOR'] } } } }
      ]
    }
  })

  if (!document) {
    return Response.json({ error: 'æ— æƒé™æˆ–æ–‡æ¡£ä¸å­˜åœ¨' }, { status: 403 })
  }

  const updatedDocument = await db.document.update({
    where: { id: params.id },
    data: { title, description, isPublic },
    include: {
      author: { select: { id: true, name: true, avatar: true } },
    }
  })

  return Response.json({ document: updatedDocument })
}

// åˆ é™¤æ–‡æ¡£
export async function DELETE(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const session = await auth()
  if (!session?.user) {
    return Response.json({ error: 'æœªæˆæƒ' }, { status: 401 })
  }

  const document = await db.document.findFirst({
    where: {
      id: params.id,
      authorId: session.user.id // åªæœ‰ä½œè€…å¯ä»¥åˆ é™¤
    }
  })

  if (!document) {
    return Response.json({ error: 'æ— æƒé™æˆ–æ–‡æ¡£ä¸å­˜åœ¨' }, { status: 403 })
  }

  await db.document.delete({
    where: { id: params.id }
  })

  return Response.json({ success: true })
}
```

## ğŸ”„ å®æ—¶æŒä¹…åŒ–æœºåˆ¶

### è‡ªåŠ¨ä¿å­˜ç­–ç•¥

| è§¦å‘äº‹ä»¶ | è¯´æ˜ | å»¶è¿Ÿ |
|---------|------|------|
| ç”¨æˆ·ç¼–è¾‘ | ä»»ä½•å†…å®¹ä¿®æ”¹ | 2ç§’é˜²æŠ– |
| åä½œåŒæ­¥ | å…¶ä»–ç”¨æˆ·ä¿®æ”¹ | 2ç§’é˜²æŠ– |
| å¼ºåˆ¶ä¿å­˜ | è¶…è¿‡30ç§’æœªä¿å­˜ | ç«‹å³ |
| ç”¨æˆ·ç¦»å¼€ | æ–­å¼€è¿æ¥æ—¶ | ç«‹å³ |

### æ•°æ®æµç¨‹

```mermaid
sequenceDiagram
    participant C1 as ç”¨æˆ·1
    participant C2 as ç”¨æˆ·2
    participant H as Hocuspocus
    participant DB as æ•°æ®åº“
    
    C1->>H: ç¼–è¾‘æ–‡æ¡£
    H->>C2: å®æ—¶åŒæ­¥åˆ°ç”¨æˆ·2
    
    Note over H: 2ç§’é˜²æŠ–å
    H->>DB: onStoreDocument ä¿å­˜
    DB-->>H: ä¿å­˜ç¡®è®¤
    
    Note over H,DB: è®°å½•æ´»åŠ¨æ—¥å¿—
```

### å®¢æˆ·ç«¯çŠ¶æ€æ˜¾ç¤º

```typescript
// components/save-status.tsx
'use client'

import { useState, useEffect } from 'react'
import { CheckCircle, Clock, AlertCircle } from 'lucide-react'

interface SaveStatusProps {
  provider?: any
}

export function SaveStatus({ provider }: SaveStatusProps) {
  const [saveStatus, setSaveStatus] = useState<'saved' | 'saving' | 'error'>('saved')
  const [lastSaved, setLastSaved] = useState<Date>(new Date())

  useEffect(() => {
    if (!provider) return

    const handleUpdate = () => setSaveStatus('saving')
    const handleSaved = () => {
      setSaveStatus('saved')
      setLastSaved(new Date())
    }
    const handleError = () => setSaveStatus('error')

    provider.on('update', handleUpdate)
    provider.on('stored', handleSaved)
    provider.on('status', ({ status }: { status: string }) => {
      if (status === 'disconnected') handleError()
    })

    return () => {
      provider.off('update', handleUpdate)
      provider.off('stored', handleSaved)
    }
  }, [provider])

  const getIcon = () => {
    switch (saveStatus) {
      case 'saved':
        return <CheckCircle className="h-4 w-4 text-green-500" />
      case 'saving':
        return <Clock className="h-4 w-4 text-yellow-500 animate-spin" />
      case 'error':
        return <AlertCircle className="h-4 w-4 text-red-500" />
    }
  }

  const getText = () => {
    switch (saveStatus) {
      case 'saved':
        return `å·²ä¿å­˜ ${lastSaved.toLocaleTimeString()}`
      case 'saving':
        return 'ä¿å­˜ä¸­...'
      case 'error':
        return 'ä¿å­˜å¤±è´¥'
    }
  }

  return (
    <div className="flex items-center gap-2 text-sm text-gray-600">
      {getIcon()}
      <span>{getText()}</span>
    </div>
  )
}
```

## ğŸ¨ å‰ç«¯ç•Œé¢å®ç°

### 1. æ–‡æ¡£åˆ—è¡¨é¡µé¢

```typescript
// app/documents/page.tsx
'use client'

import { useState } from 'react'
import { useQuery } from '@tanstack/react-query'
import { useSession } from 'next-auth/react'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { CreateDocumentDialog } from '@/components/create-document-dialog'
import { DocumentCard } from '@/components/document-card'

export default function DocumentsPage() {
  const { data: session } = useSession()
  const [searchTerm, setSearchTerm] = useState('')
  const [showCreateDialog, setShowCreateDialog] = useState(false)

  const { data, isLoading, error } = useQuery({
    queryKey: ['documents', searchTerm],
    queryFn: async () => {
      const params = new URLSearchParams()
      if (searchTerm) params.set('search', searchTerm)
      
      const response = await fetch(`/api/documents?${params}`)
      if (!response.ok) throw new Error('è·å–æ–‡æ¡£åˆ—è¡¨å¤±è´¥')
      return response.json()
    },
    enabled: !!session?.user,
  })

  if (!session) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Card className="p-8">
          <CardContent className="text-center">
            <h1 className="text-2xl font-bold mb-4">è¯·å…ˆç™»å½•</h1>
            <Button onClick={() => signIn()}>ç™»å½•</Button>
          </CardContent>
        </Card>
      </div>
    )
  }

  return (
    <div className="container mx-auto py-8">
      <div className="flex justify-between items-center mb-8">
        <div>
          <h1 className="text-3xl font-bold">æˆ‘çš„æ–‡æ¡£</h1>
          <p className="text-gray-600 mt-2">ç®¡ç†æ‚¨çš„åä½œæ–‡æ¡£</p>
        </div>
        <Button onClick={() => setShowCreateDialog(true)}>
          æ–°å»ºæ–‡æ¡£
        </Button>
      </div>

      <div className="mb-6">
        <Input
          placeholder="æœç´¢æ–‡æ¡£æ ‡é¢˜æˆ–æè¿°..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
          className="max-w-md"
        />
      </div>

      {error && (
        <Card className="mb-6 border-red-200 bg-red-50">
          <CardContent className="pt-6">
            <p className="text-red-600">åŠ è½½æ–‡æ¡£åˆ—è¡¨å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</p>
          </CardContent>
        </Card>
      )}

      {isLoading ? (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {Array.from({ length: 6 }).map((_, i) => (
            <Card key={i} className="animate-pulse">
              <CardHeader>
                <div className="h-6 bg-gray-200 rounded w-3/4 mb-2" />
                <div className="h-4 bg-gray-200 rounded w-full" />
              </CardHeader>
              <CardContent>
                <div className="h-4 bg-gray-200 rounded w-1/2" />
              </CardContent>
            </Card>
          ))}
        </div>
      ) : (
        <>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {data?.documents?.map((document: any) => (
              <DocumentCard key={document.id} document={document} />
            ))}
          </div>
          
          {data?.documents?.length === 0 && (
            <Card className="p-8">
              <CardContent className="text-center">
                <h3 className="text-lg font-medium mb-2">æš‚æ— æ–‡æ¡£</h3>
                <p className="text-gray-600 mb-4">åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªåä½œæ–‡æ¡£å§ï¼</p>
                <Button onClick={() => setShowCreateDialog(true)}>
                  åˆ›å»ºæ–‡æ¡£
                </Button>
              </CardContent>
            </Card>
          )}
        </>
      )}

      <CreateDocumentDialog 
        open={showCreateDialog}
        onOpenChange={setShowCreateDialog}
      />
    </div>
  )
}
```

### 2. å¢å¼ºçš„åä½œç¼–è¾‘å™¨

```typescript
// components/collaborative-editor.tsx
'use client'

import { useEditor, EditorContent, BubbleMenu } from '@tiptap/react'
import StarterKit from '@tiptap/starter-kit'
import Collaboration from '@tiptap/extension-collaboration'
import CollaborationCursor from '@tiptap/extension-collaboration-cursor'
import { HocuspocusProvider } from '@hocuspocus/provider'
import { useSession } from 'next-auth/react'
import * as Y from 'yjs'
import { useEffect, useState } from 'react'
import { SaveStatus } from './save-status'
// ... å…¶ä»–å¯¼å…¥

export default function CollaborativeEditor({ 
  documentId, 
  userName 
}: CollaborativeEditorProps) {
  const { data: session } = useSession()
  const [provider, setProvider] = useState<HocuspocusProvider | null>(null)
  const [status, setStatus] = useState<ConnectionStatus>('connecting')
  const [users, setUsers] = useState<User[]>([])

  // ç¼–è¾‘å™¨é…ç½®
  const editor = useEditor({
    extensions: [
      StarterKit.configure({ history: false }),
      Collaboration.configure({
        document: provider?.document,
      }),
      CollaborationCursor.configure({
        provider: provider,
        user: {
          name: userName || session?.user?.name || 'åŒ¿åç”¨æˆ·',
          color: generateUserColor(session?.user?.id || 'anonymous'),
        },
      }),
    ],
    content: '<p>æ­£åœ¨åŠ è½½æ–‡æ¡£...</p>',
  }, [provider])

  useEffect(() => {
    const ydoc = new Y.Doc()

    const hocuspocusProvider = new HocuspocusProvider({
      url: 'ws://localhost:1234',
      name: documentId,
      document: ydoc,
      token: session?.accessToken, // ä¼ é€’è®¤è¯ token
      
      onConnect() {
        setStatus('connected')
        console.log('âœ… è¿æ¥åˆ°åä½œæœåŠ¡å™¨')
      },
      
      onDisconnect() {
        setStatus('disconnected')
        console.log('âŒ ä¸åä½œæœåŠ¡å™¨æ–­å¼€è¿æ¥')
      },
      
      onAuthenticationFailed() {
        setStatus('error')
        console.error('âŒ è®¤è¯å¤±è´¥')
      }
    })

    // ç›‘å¬ç”¨æˆ·å˜åŒ–
    hocuspocusProvider.on('awarenessUpdate', () => {
      const awareness = hocuspocusProvider.awareness
      if (awareness) {
        const states = Array.from(awareness.getStates().values()) as { user?: User }[]
        setUsers(states.filter((state): state is { user: User } => !!state.user).map(state => state.user))
      }
    })

    setProvider(hocuspocusProvider)

    return () => {
      hocuspocusProvider.destroy()
    }
  }, [documentId, session])

  return (
    <div className="w-full max-w-5xl mx-auto border shadow-lg rounded-lg">
      {/* çŠ¶æ€æ  */}
      <div className="flex items-center justify-between px-6 py-3 border-b bg-white/80 backdrop-blur-sm sticky top-0 z-10">
        <div className="flex items-center gap-3">
          {/* è¿æ¥çŠ¶æ€ */}
          <ConnectionStatus status={status} />
          
          <div className="h-4 w-px bg-gray-300" />
          
          {/* ä¿å­˜çŠ¶æ€ */}
          <SaveStatus provider={provider} />
          
          <div className="h-4 w-px bg-gray-300" />
          
          <div className="text-sm text-gray-500">
            æ–‡æ¡£: <span className="font-medium text-gray-700">{documentId}</span>
          </div>
        </div>
        
        {/* åœ¨çº¿ç”¨æˆ· */}
        <UserAvatars users={users} />
      </div>

      {/* ç¼–è¾‘å™¨ */}
      <div className="p-6">
        {editor && (
          <>
            <BubbleMenu editor={editor}>
              <ToolbarBubble editor={editor} />
            </BubbleMenu>
            
            <EditorContent editor={editor} />
          </>
        )}
      </div>
    </div>
  )
}
```

## ğŸš€ éƒ¨ç½²å’Œç¯å¢ƒé…ç½®

### ç¯å¢ƒå˜é‡

```bash
# .env.local

# æ•°æ®åº“
DATABASE_URL="sqlite:./dev.db"  # å¼€å‘ç¯å¢ƒ
# DATABASE_URL="postgresql://username:password@localhost:5432/collaborator_db"  # ç”Ÿäº§ç¯å¢ƒ

# è®¤è¯
NEXTAUTH_SECRET="your-super-secret-key-here"
NEXTAUTH_URL="http://localhost:3000"

# OAuth æä¾›è€…
GITHUB_CLIENT_ID="your-github-client-id"
GITHUB_CLIENT_SECRET="your-github-client-secret"
GOOGLE_CLIENT_ID="your-google-client-id"
GOOGLE_CLIENT_SECRET="your-google-client-secret"

# åº”ç”¨é…ç½®
NODE_ENV="development"
```

### å¼€å‘è„šæœ¬

```json
{
  "scripts": {
    "dev": "npm run db:push && npm run stop-server && next dev --turbopack",
    "build": "npm run db:push && next build",
    "start": "next start",
    "lint": "next lint",
    "db:push": "prisma db push",
    "db:studio": "prisma studio",
    "db:reset": "prisma db push --force-reset",
    "stop-server": "lsof -ti:1234 | xargs kill -9 2>/dev/null || true"
  }
}
```

## ğŸ“‹ å®æ–½è®¡åˆ’

### âœ… ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®æŒä¹…åŒ– (å·²å®Œæˆ - ç”¨æ—¶7.5å°æ—¶)
- [x] **åŸºç¡€è®¾æ–½é…ç½®** - Prisma ORM + SQLite æ•°æ®åº“é…ç½®
- [x] **æ•°æ®æ¨¡å‹è®¾è®¡** - å®Œæ•´çš„æ–‡æ¡£ã€ç”¨æˆ·ã€åä½œå…³ç³»æ¨¡å‹
- [x] **æ–‡æ¡£ CRUD API** - 19ä¸ªAPIç«¯ç‚¹ï¼Œ100%æµ‹è¯•é€šè¿‡
- [x] **å®æ—¶æŒä¹…åŒ–æœºåˆ¶** - Hocuspocusç›´è¿æ•°æ®åº“ï¼Œ2ç§’é˜²æŠ–ä¿å­˜
- [x] **è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶** - åŠŸèƒ½æµ‹è¯• + æ€§èƒ½åŸºå‡†æµ‹è¯•
- [x] **å®Œæ•´æ–‡æ¡£** - READMEæ›´æ–°ï¼ŒæŠ€æœ¯æ–¹æ¡ˆå®Œå–„

**ğŸ‰ ç¬¬ä¸€é˜¶æ®µæˆæœï¼š**
- âœ… æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ï¼š1-3ms (ä¼˜ç§€)
- âœ… APIå“åº”æ€§èƒ½ï¼š19-24ms (ä¼˜ç§€)  
- âœ… å¤šç”¨æˆ·åä½œï¼š3ç”¨æˆ·å¹¶å‘æµ‹è¯•é€šè¿‡
- âœ… æ•°æ®å®Œæ•´æ€§ï¼š100% (é›¶æ•°æ®ä¸¢å¤±)
- âœ… èµ„æºç®¡ç†ï¼š100%æ¸…ç†ç‡ï¼Œæ— å†…å­˜æ³„æ¼

### ğŸ”„ ç¬¬äºŒé˜¶æ®µï¼šç”¨æˆ·è®¤è¯ç³»ç»Ÿ (è§„åˆ’ä¸­ - é¢„è®¡2-3å‘¨)
- [ ] **NextAuth.js é›†æˆ** - é…ç½®è®¤è¯æä¾›è€…å’Œä¼šè¯ç®¡ç†
- [ ] **OAuth æä¾›è€…** - GitHubã€Google ç™»å½•æ”¯æŒ
- [ ] **ç”¨æˆ·æƒé™ç³»ç»Ÿ** - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)
- [ ] **è®¤è¯ç•Œé¢** - ç™»å½•ã€æ³¨å†Œã€ç”¨æˆ·èµ„æ–™é¡µé¢
- [ ] **æƒé™æµ‹è¯•** - æ–‡æ¡£è®¿é—®æƒé™éªŒè¯

**æŠ€æœ¯è¦ç‚¹ï¼š**
- NextAuth.js v5 é›†æˆ
- Prisma é€‚é…å™¨
- JWT token éªŒè¯
- æ–‡æ¡£çº§æƒé™æ§åˆ¶

### ğŸ”„ ç¬¬ä¸‰é˜¶æ®µï¼šå‰ç«¯ç•Œé¢å¼€å‘ (è§„åˆ’ä¸­ - é¢„è®¡3-4å‘¨)
- [ ] **æ–‡æ¡£ç®¡ç†ç•Œé¢** - æ–‡æ¡£åˆ—è¡¨ã€åˆ›å»ºã€ç¼–è¾‘é¡µé¢
- [ ] **åä½œç¼–è¾‘å™¨** - å¢å¼ºç°æœ‰ç¼–è¾‘å™¨ï¼Œæ·»åŠ ä¿å­˜çŠ¶æ€æ˜¾ç¤º
- [ ] **ç”¨æˆ·ç•Œé¢** - ç”¨æˆ·èµ„æ–™ã€è®¾ç½®ã€åä½œè€…ç®¡ç†
- [ ] **å“åº”å¼è®¾è®¡** - ç§»åŠ¨ç«¯é€‚é…
- [ ] **çŠ¶æ€ç®¡ç†** - Zustand + TanStack Query

**UI ç»„ä»¶ï¼š**
- åŸºäº shadcn/ui çš„ç°ä»£åŒ–ç•Œé¢
- å®æ—¶ä¿å­˜çŠ¶æ€æŒ‡ç¤ºå™¨
- åœ¨çº¿ç”¨æˆ·åˆ—è¡¨å’Œåä½œå…‰æ ‡
- æ–‡æ¡£æƒé™ç®¡ç†ç•Œé¢

### ğŸ”„ ç¬¬å››é˜¶æ®µï¼šç”Ÿäº§ä¼˜åŒ– (è§„åˆ’ä¸­ - é¢„è®¡2-3å‘¨)
- [ ] **æ€§èƒ½ä¼˜åŒ–** - æ•°æ®åº“ç´¢å¼•ã€æŸ¥è¯¢ä¼˜åŒ–ã€ç¼“å­˜ç­–ç•¥
- [ ] **é”™è¯¯å¤„ç†** - å®Œå–„é”™è¯¯æ¢å¤æœºåˆ¶å’Œç”¨æˆ·æç¤º
- [ ] **ç›‘æ§ç³»ç»Ÿ** - æ€§èƒ½ç›‘æ§ã€é”™è¯¯è¿½è¸ªã€ä¸šåŠ¡æŒ‡æ ‡
- [ ] **éƒ¨ç½²é…ç½®** - DockeråŒ–ã€CI/CDã€ç¯å¢ƒé…ç½®
- [ ] **æ–‡æ¡£å®Œå–„** - éƒ¨ç½²æŒ‡å—ã€APIæ–‡æ¡£ã€å¼€å‘æ‰‹å†Œ

**ç”Ÿäº§ç‰¹æ€§ï¼š**
- PostgreSQL æ•°æ®åº“æ”¯æŒ
- Redis ç¼“å­˜å±‚
- è´Ÿè½½å‡è¡¡é…ç½®
- å¥åº·æ£€æŸ¥å’Œç›‘æ§

### ğŸ”„ ç¬¬äº”é˜¶æ®µï¼šæ‰©å±•åŠŸèƒ½ (é•¿æœŸè§„åˆ’ - 6ä¸ªæœˆ+)
- [ ] **æ–‡æ¡£æ¨¡æ¿ç³»ç»Ÿ** - é¢„å®šä¹‰æ¨¡æ¿ï¼Œå¿«é€Ÿåˆ›å»º
- [ ] **è¯„è®ºå’Œå»ºè®®** - æ–‡æ¡£è¯„è®ºã€ä¿®æ”¹å»ºè®®åŠŸèƒ½
- [ ] **ç‰ˆæœ¬å†å²** - æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†å’Œå›æ»š
- [ ] **æ–‡æ¡£å¯¼å‡º** - PDFã€Wordã€Markdown å¯¼å‡º
- [ ] **æ’ä»¶ç³»ç»Ÿ** - è‡ªå®šä¹‰æ‰©å±•å’Œç¬¬ä¸‰æ–¹é›†æˆ
- [ ] **API å¼€æ”¾å¹³å°** - å¼€æ”¾ APIï¼Œæ”¯æŒç¬¬ä¸‰æ–¹é›†æˆ

## ğŸ“Š é¡¹ç›®æ—¶é—´çº¿

| é˜¶æ®µ | è®¡åˆ’æ—¶é—´ | å®é™…å®Œæˆ | ä¸»è¦äº¤ä»˜ç‰© | çŠ¶æ€ |
|------|---------|---------|-----------|------|
| **ç¬¬ä¸€é˜¶æ®µ** | 2å‘¨ | 7.5å°æ—¶ | æ•°æ®æŒä¹…åŒ–ç³»ç»Ÿ | âœ… **å·²å®Œæˆ** |
| **ç¬¬äºŒé˜¶æ®µ** | 2-3å‘¨ | - | ç”¨æˆ·è®¤è¯ç³»ç»Ÿ | ğŸ”„ **è§„åˆ’ä¸­** |
| **ç¬¬ä¸‰é˜¶æ®µ** | 3-4å‘¨ | - | å‰ç«¯ç•Œé¢ | ğŸ”„ **è§„åˆ’ä¸­** |
| **ç¬¬å››é˜¶æ®µ** | 2-3å‘¨ | - | ç”Ÿäº§ä¼˜åŒ– | ğŸ”„ **è§„åˆ’ä¸­** |
| **ç¬¬äº”é˜¶æ®µ** | 6ä¸ªæœˆ+ | - | æ‰©å±•åŠŸèƒ½ | ğŸ”„ **é•¿æœŸè§„åˆ’** |

**æ€»é¢„è®¡æ—¶é—´ï¼š** 10-12å‘¨ (æ ¸å¿ƒåŠŸèƒ½) + 6ä¸ªæœˆ (æ‰©å±•åŠŸèƒ½)

## ğŸ¯ é‡Œç¨‹ç¢‘æ£€æŸ¥ç‚¹

### âœ… æ£€æŸ¥ç‚¹ 1ï¼šæ•°æ®åŸºç¡€å®Œæˆ (å·²è¾¾æˆ)
- [x] æ•°æ®åº“æ¨¡å‹è®¾è®¡å’Œå®ç°
- [x] CRUD API å®Œæ•´åŠŸèƒ½
- [x] å®æ—¶æŒä¹…åŒ–æœºåˆ¶
- [x] è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–

### ğŸ”„ æ£€æŸ¥ç‚¹ 2ï¼šç”¨æˆ·ç³»ç»Ÿå®Œæˆ (ç¬¬äºŒé˜¶æ®µ)
- [ ] ç”¨æˆ·è®¤è¯æµç¨‹å®Œæ•´
- [ ] æƒé™æ§åˆ¶ç³»ç»Ÿå·¥ä½œ
- [ ] å®‰å…¨æ€§éªŒè¯é€šè¿‡
- [ ] è®¤è¯ç›¸å…³æµ‹è¯•è¦†ç›–

### ğŸ”„ æ£€æŸ¥ç‚¹ 3ï¼šç”¨æˆ·ç•Œé¢å®Œæˆ (ç¬¬ä¸‰é˜¶æ®µ)  
- [ ] æ‰€æœ‰æ ¸å¿ƒé¡µé¢å®ç°
- [ ] ç”¨æˆ·ä½“éªŒæµç•…
- [ ] ç§»åŠ¨ç«¯é€‚é…å®Œæˆ
- [ ] ç•Œé¢æµ‹è¯•é€šè¿‡

### ğŸ”„ æ£€æŸ¥ç‚¹ 4ï¼šç”Ÿäº§å°±ç»ª (ç¬¬å››é˜¶æ®µ)
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- [ ] ç›‘æ§ç³»ç»Ÿè¿è¡Œ
- [ ] éƒ¨ç½²æµç¨‹å®Œå–„
- [ ] ç”Ÿäº§ç¯å¢ƒéªŒè¯

## ğŸ”„ ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

### å³å°†å¼€å§‹ï¼šç¬¬äºŒé˜¶æ®µ - ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

#### ä¼˜å…ˆä»»åŠ¡ï¼š
1. **NextAuth.js é›†æˆ** (1-2å¤©)
   - å®‰è£…å’Œé…ç½® NextAuth.js v5
   - è®¾ç½® Prisma é€‚é…å™¨
   - é…ç½®ä¼šè¯ç®¡ç†

2. **OAuth æä¾›è€…é…ç½®** (1-2å¤©)
   - GitHub OAuth è®¾ç½®
   - Google OAuth è®¾ç½®  
   - è®¤è¯å›è°ƒå¤„ç†

3. **æƒé™ç³»ç»Ÿè®¾è®¡** (2-3å¤©)
   - æ‰©å±•æ•°æ®æ¨¡å‹
   - å®ç° RBAC æƒé™æ§åˆ¶
   - API æƒé™ä¸­é—´ä»¶

4. **è®¤è¯æµ‹è¯•** (1-2å¤©)
   - è®¤è¯æµç¨‹æµ‹è¯•
   - æƒé™éªŒè¯æµ‹è¯•
   - å®‰å…¨æ€§æµ‹è¯•

#### é¢„æœŸäº§å‡ºï¼š
- å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
- è®¤è¯ç›¸å…³çš„æµ‹è¯•å¥—ä»¶
- å®‰å…¨æ€§éªŒè¯æŠ¥å‘Š

### æŠ€æœ¯å€ºåŠ¡ç®¡ç†

å½“å‰æŠ€æœ¯å€ºåŠ¡è¾ƒå°‘ï¼Œä¸»è¦åŒ…æ‹¬ï¼š
- [ ] ç¡¬ç¼–ç çš„ç”¨æˆ·IDéœ€è¦æ›¿æ¢ä¸ºçœŸå®ç”¨æˆ·ç³»ç»Ÿ
- [ ] ä¸´æ—¶çš„æƒé™è·³è¿‡é€»è¾‘éœ€è¦å®Œå–„
- [ ] é”™è¯¯å¤„ç†å¯ä»¥è¿›ä¸€æ­¥ç»†åŒ–

è¿™äº›å°†åœ¨ç¬¬äºŒé˜¶æ®µä¸­è§£å†³ã€‚

## ğŸ”’ å®‰å…¨æ€§è€ƒè™‘

### 1. è®¤è¯å’Œæˆæƒ
- JWT token éªŒè¯
- æ–‡æ¡£çº§åˆ«çš„æƒé™æ§åˆ¶
- è§’è‰²åŸºç¡€çš„è®¿é—®æ§åˆ¶

### 2. æ•°æ®å®‰å…¨
- è¾“å…¥éªŒè¯å’Œæ¸…ç†
- SQL æ³¨å…¥é˜²æŠ¤ï¼ˆPrisma è‡ªåŠ¨å¤„ç†ï¼‰
- XSS é˜²æŠ¤

### 3. ç½‘ç»œå®‰å…¨
- WebSocket è¿æ¥éªŒè¯
- CORS é…ç½®
- ç‡é™åˆ¶

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–
- ç´¢å¼•ä¼˜åŒ–
- æŸ¥è¯¢ä¼˜åŒ–
- è¿æ¥æ± é…ç½®

### 2. å®æ—¶åŒæ­¥ä¼˜åŒ–
- é˜²æŠ–æœºåˆ¶å‡å°‘ä¿å­˜é¢‘ç‡
- å¢é‡åŒæ­¥
- è¿æ¥çŠ¶æ€ç®¡ç†

### 3. å‰ç«¯ä¼˜åŒ–
- React Query ç¼“å­˜
- ç»„ä»¶æ‡’åŠ è½½
- å›¾ç‰‡ä¼˜åŒ–

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. åº”ç”¨ç›‘æ§
- è¿æ¥æ•°ç›‘æ§
- é”™è¯¯ç‡ç›‘æ§
- æ€§èƒ½æŒ‡æ ‡

### 2. ä¸šåŠ¡æŒ‡æ ‡
- æ–‡æ¡£åˆ›å»ºæ•°é‡
- æ´»è·ƒç”¨æˆ·æ•°
- åä½œä¼šè¯æ—¶é•¿

## ğŸ¯ æ‰©å±•è§„åˆ’

### è¿‘æœŸæ‰©å±•
- [ ] æ–‡æ¡£æ¨¡æ¿ç³»ç»Ÿ
- [ ] è¯„è®ºå’Œå»ºè®®åŠŸèƒ½
- [ ] æ–‡æ¡£å¯¼å‡ºï¼ˆPDFã€Wordï¼‰
- [ ] ç§»åŠ¨ç«¯é€‚é…

### é•¿æœŸè§„åˆ’
- [ ] ä¼ä¸šçº§æƒé™ç®¡ç†
- [ ] æ’ä»¶ç³»ç»Ÿ
- [ ] API å¼€æ”¾å¹³å°
- [ ] å¤šè¯­è¨€æ”¯æŒ

## æ€»ç»“

è¯¥æŠ€æœ¯æ–¹æ¡ˆæä¾›äº†å®Œæ•´çš„å®æ—¶åä½œæ–‡æ¡£ç®¡ç†ç³»ç»Ÿå®ç°è·¯å¾„ï¼ŒåŒ…æ‹¬ï¼š

âœ… **è‡ªåŠ¨å¯åŠ¨æœåŠ¡å™¨** - é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ Hocuspocus  
âœ… **ç›´è¿æ•°æ®åº“æ¶æ„** - é«˜æ€§èƒ½çš„æ•°æ®æŒä¹…åŒ–  
âœ… **å®æ—¶åä½œ** - æ— æ„ŸçŸ¥çš„è‡ªåŠ¨ä¿å­˜å’ŒåŒæ­¥  
âœ… **å®Œæ•´æƒé™ç³»ç»Ÿ** - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶  
âœ… **ç°ä»£åŒ–ç•Œé¢** - åŸºäº shadcn/ui çš„ç¾è§‚ç•Œé¢  
âœ… **ç”Ÿäº§å°±ç»ª** - å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç›‘æ§  

é€šè¿‡åˆ†é˜¶æ®µå®æ–½ï¼Œå¯ä»¥ç¡®ä¿é¡¹ç›®ç¨³æ­¥æ¨è¿›ï¼Œæœ€ç»ˆäº¤ä»˜ä¸€ä¸ªåŠŸèƒ½å®Œå–„ã€æ€§èƒ½ä¼˜å¼‚çš„åä½œæ–‡æ¡£ç³»ç»Ÿã€‚ 