# 日历节点功能指南

## 概述

我们成功为Tiptap协作编辑器添加了一个自定义的日历节点类型，使用React View方式实现，集成了shadcn/ui的日历组件。这个功能主要用于测试自定义节点以及它们在协作环境中的同步。

## 功能特性

### ✅ 已实现的功能

1. **自定义日历节点**
   - 使用Tiptap的React NodeView实现
   - 集成shadcn/ui的Calendar组件
   - 支持日期选择和显示

2. **协作同步**
   - 日历节点的所有属性都会在多用户间实时同步
   - 包括选中的日期、标题等

3. **交互功能**
   - 可编辑的标题输入框
   - 日期选择器（点击按钮展开/收起）
   - 删除节点按钮
   - 选中状态高亮显示

4. **UI/UX**
   - 现代化的卡片式设计
   - 响应式布局
   - 悬停效果和过渡动画
   - 与编辑器整体风格一致

## 使用方法

### 1. 插入日历节点

在编辑器中有两种方式插入日历节点：

**方法一：通过工具栏**
- 选中任意文本
- 在弹出的BubbleMenu中点击"📅 日历"按钮

**方法二：通过命令**
```javascript
editor.chain().focus().insertCalendar().run()
```

### 2. 编辑日历节点

- **编辑标题**：点击标题区域直接输入
- **选择日期**：点击"选择日期"按钮，在弹出的日历中选择
- **删除节点**：点击右上角的"×"按钮

### 3. 协作测试

1. 启动服务器：`npm run dev`
2. 打开多个浏览器窗口访问 `http://localhost:3000`
3. 使用相同的文档ID进入协作编辑
4. 在一个窗口中插入日历节点并编辑
5. 观察其他窗口中的实时同步效果

## 技术实现

### 文件结构

```
src/
├── components/
│   ├── calendar-node.tsx          # 日历节点React组件
│   ├── collaborative-editor.tsx   # 协作编辑器（已修改）
│   └── ui/
│       └── calendar.tsx           # shadcn/ui日历组件
├── lib/
│   └── calendar-extension.ts      # Tiptap日历扩展定义
└── styles/
    └── tiptap.css                 # 日历节点样式
```

### 核心组件

1. **CalendarExtension** (`src/lib/calendar-extension.ts`)
   - 定义日历节点的结构和属性
   - 实现插入命令
   - 配置React NodeView渲染器

2. **CalendarNodeView** (`src/components/calendar-node.tsx`)
   - React组件实现日历节点的UI
   - 处理用户交互和状态管理
   - 与Tiptap编辑器通信

3. **协作编辑器集成**
   - 在扩展列表中添加CalendarExtension
   - 在工具栏中添加插入按钮

### 数据结构

日历节点存储以下属性：
```typescript
{
  title: string,        // 日历标题
  selectedDate: string  // 选中的日期（ISO字符串）
}
```

## 测试场景

### 基本功能测试
- [ ] 插入日历节点
- [ ] 编辑标题
- [ ] 选择日期
- [ ] 删除节点

### 协作同步测试
- [ ] 多用户同时编辑同一日历节点
- [ ] 日期选择的实时同步
- [ ] 标题编辑的实时同步
- [ ] 节点删除的同步

### 边界情况测试
- [ ] 空标题处理
- [ ] 无选中日期状态
- [ ] 网络断开重连后的同步
- [ ] 大量日历节点的性能

## 扩展可能性

这个日历节点为进一步的功能扩展奠定了基础：

1. **增强功能**
   - 日期范围选择
   - 时间选择器
   - 重复事件设置
   - 提醒功能

2. **样式定制**
   - 主题切换
   - 自定义颜色
   - 不同的日历视图

3. **数据集成**
   - 与外部日历系统集成
   - 事件导入/导出
   - 数据持久化

## 故障排除

### 常见问题

1. **日历不显示**
   - 检查date-fns是否正确安装
   - 确认shadcn/ui组件已正确配置

2. **协作同步失败**
   - 确认Hocuspocus服务器正在运行
   - 检查网络连接状态

3. **样式问题**
   - 确认tiptap.css已正确导入
   - 检查Tailwind CSS配置

### 调试技巧

- 使用浏览器开发者工具查看节点属性
- 检查控制台是否有错误信息
- 使用Tiptap的调试工具查看文档结构

## 总结

这个日历节点功能成功演示了：
- 如何创建自定义Tiptap节点
- 如何使用React View进行复杂UI渲染
- 如何在协作环境中同步自定义节点
- 如何集成第三方UI组件库

这为后续开发更复杂的自定义节点类型提供了很好的参考模板。 